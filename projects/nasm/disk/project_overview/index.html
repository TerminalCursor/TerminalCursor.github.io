<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title>FOSS Website</title>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta name="description" content="Here is a description" />
  <meta name="author" content="Terminal Cursor" />
  <meta name="generator" content="mero theme by Darshan in Hugo 0.69.2" />

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
    crossorigin="anonymous"
  />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Overlock|Roboto+Mono&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/mero.css" />

  <script src="/js/mero.js"></script>
</head>

  <body class="bg-dark text-white m-auto" style="width:95%; max-width: 1024px;">
    <div class="wrapper">
      <nav class="mb-3 mt-3 ml-1">
  <div class="d-flex flex-row">
    <div
      class="menu-item border border-warning bg-dark p-2"
      style="border-top-left-radius: 10px; border-bottom-left-radius: 10px;"
    >
      <a href="/"><span>Home</span> </a>
    </div>
    <div class="menu-item dropdown border border-warning bg-dark p-2">
      <span class="dropbtn text-warning" onclick="toggleMenu(this)"
        >Sections <i class="fas fa-angle-down"></i
      ></span>
      <div
        class="dropdown-content p-2 bg-dark2 mt-2 rounded w-auto mt-1 d-none"
        style="min-width: 200px;"
      >
        <ul class="list-unstyled">
          
          
          
          <li class="pt-2">
            <a href="http://TerminalCursor.github.io/projects/">Projects</a>
          </li>
          
          
          
          
          <li class="pt-2">
            <a href="http://TerminalCursor.github.io/posts/">Posts</a>
          </li>
          
          
        </ul>
      </div>
    </div>
    <div class="menu-item border border-warning bg-dark p-2">
      <a
        href="/alltaxa/"
        ><span>Taxa</span>
      </a>
    </div>
    <div class="menu-item border border-warning bg-dark p-2"
    style="border-top-right-radius: 10px; border-bottom-right-radius: 10px;">
      <a
        href="/archive/"
        ><span>Archive</span>
      </a>
    </div>
  </div>
</nav>

      <main>
        
<article class="border rounded p-3 position-relative" style="margin-top: 2.5em;">
  <div class="header">
    <h1 style="font-size: 2.5em;">
      ASM Disk Project Overview
    </h1>
    <div
    class="mb-1 mr-3 pl-1 pr-1 rounded bg-dark"
    style="position: absolute; top: -19px; font-size: 0.9em;"
  >
    <time>2020-05-08</time>    
    <span
      class="more"
      style="font-size: 1.5em;"
      title="Show Metadata"
      onclick="showMetadata(this)"
    >
      &#43;
    </span>
  </div><div class="m-2 metadata overflow-hidden" style="max-height: 0px;">
  
  <div class="metadata-value mb-1 taxa taxa-container-div list-sections">
    <div>
      Reading Time: 
5 mins
      
    </div>
    <div>
      Section:
      <a
        class="pl-1 pr-1 rounded border border-secondary"
        href="/projects"
        title="Section"
      >Projects</a>
    </div>
  </div>
  

  
  
  
  
  
  
</div>
</div>
  <div class="article pb-3 pt-3 border-bottom border-top">
    
    <p>Makefile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Makefile" data-lang="Makefile">SRC<span style="color:#f92672">=</span>main
OUT<span style="color:#f92672">=</span>build
EXTRAS<span style="color:#f92672">=</span>data.dat
SOURCE<span style="color:#f92672">=</span>main.asm debug.asm disk.asm useful.asm
<span style="color:#a6e22e">build</span><span style="color:#f92672">:</span> ${SRC}.asm
	nasm -f elf64 -o <span style="color:#e6db74">${</span>SRC<span style="color:#e6db74">}</span>.o <span style="color:#e6db74">${</span>SRC<span style="color:#e6db74">}</span>.asm
	ld <span style="color:#e6db74">${</span>SRC<span style="color:#e6db74">}</span>.o -o <span style="color:#e6db74">${</span>OUT<span style="color:#e6db74">}</span>
	chmod +x <span style="color:#e6db74">${</span>OUT<span style="color:#e6db74">}</span>

<span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	rm -rf <span style="color:#e6db74">${</span>OUT<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>SRC<span style="color:#e6db74">}</span>.o <span style="color:#e6db74">${</span>EXTRAS<span style="color:#e6db74">}</span>

<span style="color:#a6e22e">backup</span><span style="color:#f92672">:</span>
	cp Makefile <span style="color:#e6db74">${</span>SOURCE<span style="color:#e6db74">}</span> ./backups.d
</code></pre></div><p>main.asm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">section</span> <span style="color:#66d9ef">.data</span>
	<span style="color:#a6e22e">NL</span> <span style="color:#66d9ef">db</span> <span style="color:#ae81ff">0x0A</span>

<span style="color:#a6e22e">section</span> <span style="color:#66d9ef">.bss</span>
	<span style="color:#a6e22e">fileData</span> <span style="color:#66d9ef">resb</span> <span style="color:#ae81ff">201</span>

<span style="color:#a6e22e">section</span> <span style="color:#66d9ef">.text</span>
	<span style="color:#a6e22e">global</span> <span style="color:#66d9ef">_start</span>

<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">include</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">useful.asm</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">include</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">disk.asm</span><span style="color:#960050;background-color:#1e0010">&#34;</span>
<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">include</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">debug.asm</span><span style="color:#960050;background-color:#1e0010">&#34;</span>

dumpAll:
	<span style="color:#a6e22e">call</span> <span style="color:#66d9ef">printNl</span>
	<span style="color:#75715e">;;;
</span><span style="color:#75715e"></span>	<span style="color:#75715e">;;; Dump Register Contents
</span><span style="color:#75715e"></span>	<span style="color:#75715e">;;;
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RAX</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rax</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RBX</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rbx</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RCX</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rcx</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RDX</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RDI</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RSI</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RSP</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rsp</span>
	<span style="color:#a6e22e">PRINT</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">RBP</span>: <span style="color:#960050;background-color:#1e0010">&#34;</span>		<span style="color:#75715e">;; Output the contents of rax (file handle)
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">dumpRegister</span> <span style="color:#66d9ef">rbp</span>
	<span style="color:#a6e22e">call</span> <span style="color:#66d9ef">printNl</span>
	<span style="color:#a6e22e">ret</span>

_start:

	<span style="color:#a6e22e">fopen</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>.<span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">data.dat</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#ae81ff">01</span>	<span style="color:#75715e">;; Open the file in 01-WT mode
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>		<span style="color:#75715e">;; Push rax to the stack to preserve the file handle
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">call</span> <span style="color:#66d9ef">dumpAll</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>			<span style="color:#75715e">;; Restore rax
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0xFFFFFFFE</span>	<span style="color:#75715e">;; Open sets rax to 0xFFFFFFFE if there is no file
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">jne</span> <span style="color:#66d9ef">regularOperation</span>	<span style="color:#75715e">;; If there is a file, non 0xFFFFFFFE, continue as usual
</span><span style="color:#75715e"></span>
createIfNotExist:
	<span style="color:#a6e22e">fcreate</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>.<span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">data.dat</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#ae81ff">644</span><span style="color:#66d9ef">q</span>	<span style="color:#75715e">;; Create an empty file
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">fopen</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>.<span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">data.dat</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#ae81ff">01</span>		<span style="color:#75715e">;; Open to write
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rax</span>			<span style="color:#75715e">;; Preserve file handle
</span><span style="color:#75715e"></span>
regularOperation:

	<span style="color:#a6e22e">fwrite</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">Testing</span> <span style="color:#66d9ef">out</span> <span style="color:#66d9ef">macro</span><span style="color:#960050;background-color:#1e0010">&#34;</span>	<span style="color:#75715e">;; Write data to file
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">fwrite</span> <span style="color:#ae81ff">0x0A</span>			<span style="color:#75715e">;; Write new line
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">fwrite</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#66d9ef">Writing</span> <span style="color:#66d9ef">some</span> <span style="color:#66d9ef">more</span><span style="color:#960050;background-color:#1e0010">&#34;</span>	<span style="color:#75715e">;; Write data to file
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">fclose</span>	<span style="color:#66d9ef">rax</span>			<span style="color:#75715e">;; Close the file
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">fopen</span> <span style="color:#960050;background-color:#1e0010">&#34;</span>.<span style="color:#960050;background-color:#1e0010">/</span><span style="color:#66d9ef">data.dat</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#ae81ff">00</span>		<span style="color:#75715e">;; Open the file in RD mode
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">fread</span> <span style="color:#66d9ef">fileData</span>, <span style="color:#ae81ff">200</span>		<span style="color:#75715e">;; Read 200 bytes of a file
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">fclose</span>	<span style="color:#66d9ef">rax</span>			<span style="color:#75715e">;; Close file
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">_syscall_write</span> <span style="color:#66d9ef">fileData</span>, <span style="color:#ae81ff">200</span>	<span style="color:#75715e">;; Write the file data
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">call</span> <span style="color:#66d9ef">printNl</span>			<span style="color:#75715e">;; Add a new line
</span><span style="color:#75715e"></span>
<span style="color:#75715e">;; Exit, TODO: make this a macro in the useful.asm
</span><span style="color:#75715e"></span>exit:
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">60</span>		<span style="color:#75715e">;; Exit
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#ae81ff">0</span>		<span style="color:#75715e">;; Exit code
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">call</span> <span style="color:#66d9ef">dumpAll</span>
	<span style="color:#a6e22e">syscall</span>

<span style="color:#75715e">;; Print a new line, TODO: make this a macro in the useful.asm
</span><span style="color:#75715e"></span>printNl:
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdx</span>

	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">NL</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">syscall</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>
	<span style="color:#a6e22e">ret</span>
</code></pre></div><p>debug.asm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">section</span> <span style="color:#66d9ef">.data</span>
	<span style="color:#a6e22e">hexOut</span> <span style="color:#66d9ef">db</span> <span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#ae81ff">0x00000000</span><span style="color:#960050;background-color:#1e0010">&#34;</span>, <span style="color:#ae81ff">0x0A</span>
	<span style="color:#a6e22e">hexLen</span> <span style="color:#66d9ef">equ</span> <span style="color:#66d9ef">$</span> - <span style="color:#66d9ef">hexOut</span>

<span style="color:#a6e22e">section</span> <span style="color:#66d9ef">.text</span>
<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">dumpRegister</span> <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Preserve stack
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rbx</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rcx</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">r9</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">r10</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">r11</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">r12</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdi</span>

	<span style="color:#a6e22e">push</span> <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">r12</span>		<span style="color:#75715e">;; Move the data to r12
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">r10</span>, <span style="color:#66d9ef">r10</span>	<span style="color:#75715e">;; r10 will be the incrementer
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r9</span>, <span style="color:#ae81ff">0xF</span>	<span style="color:#75715e">;; r9 will grab individual bytes
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">r11</span>, <span style="color:#66d9ef">hexOut</span>	<span style="color:#75715e">;; r11 holds the hex output
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">add</span> <span style="color:#66d9ef">r11</span>, <span style="color:#ae81ff">2</span>	<span style="color:#75715e">;; Omit 0x from write
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span>%btoa:			<span style="color:#75715e">;; Byte to ascii
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">xor</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Clear rax
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">7</span>	<span style="color:#75715e">;; Start at the leading byte
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">sub</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">r10</span>	<span style="color:#75715e">;; Go from MSB to LSB
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#ae81ff">4</span>	<span style="color:#75715e">;; Multiply by 4
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mul</span> <span style="color:#66d9ef">rdx</span>		<span style="color:#75715e">;; Multiply rax by 4, move 4 bits for every increment
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rcx</span>, <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Set rcx to (7 - r10)*4
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">r12</span>	<span style="color:#75715e">;; Set rax to the hex we want to display
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">shr</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">cl</span>	<span style="color:#75715e">;; Shift data by 4 bits per increment
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">and</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">r9</span>	<span style="color:#75715e">;; Get the current byte
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">10</span>	<span style="color:#75715e">;; Check if hex
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">jge</span> <span style="color:#960050;background-color:#1e0010">%</span>%hex	<span style="color:#75715e">;; If so, treat as hex
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">add</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x30</span>	<span style="color:#75715e">;; Adjust to ascii number if not hex
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">jmp</span> <span style="color:#960050;background-color:#1e0010">%</span>%check
<span style="color:#960050;background-color:#1e0010">%%</span>hex:
	<span style="color:#a6e22e">add</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x37</span>	<span style="color:#75715e">;; Adjust to ascii hex
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span>%check:
	<span style="color:#a6e22e">mov</span> [<span style="color:#66d9ef">r11</span>], <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Insert the byte to the string
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">cmp</span> <span style="color:#66d9ef">r10</span>, <span style="color:#ae81ff">7</span>	<span style="color:#75715e">;; See if we have reached the end
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">jge</span> <span style="color:#960050;background-color:#1e0010">%</span>%appendNL	<span style="color:#75715e">;; If we have, add the new line and call it good
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">inc</span> <span style="color:#66d9ef">r10</span>		<span style="color:#75715e">;; If not, increment and start again
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">inc</span> <span style="color:#66d9ef">r11</span>
	<span style="color:#a6e22e">jmp</span> <span style="color:#960050;background-color:#1e0010">%</span>%btoa
<span style="color:#960050;background-color:#1e0010">%%</span>appendNL:
	<span style="color:#a6e22e">inc</span> <span style="color:#66d9ef">r11</span>		<span style="color:#75715e">;; Go to the last position of the string
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x0A</span>	<span style="color:#75715e">;; Insert a new line
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> [<span style="color:#66d9ef">r11</span>], <span style="color:#66d9ef">rax</span>

	<span style="color:#75715e">;; Print the hex
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#66d9ef">hexOut</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#66d9ef">hexLen</span>
	<span style="color:#a6e22e">syscall</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">r12</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">r11</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">r10</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">r9</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rcx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rbx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>		<span style="color:#75715e">;; Preserve stack
</span><span style="color:#75715e"></span>%endmacro
</code></pre></div><p>disk.asm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#75715e">;; File create
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">fcreate</span> <span style="color:#ae81ff">2</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>

	<span style="color:#a6e22e">jmp</span> <span style="color:#960050;background-color:#1e0010">%</span>%createCode
	<span style="color:#960050;background-color:#1e0010">%%</span><span style="color:#a6e22e">fileName</span> <span style="color:#66d9ef">db</span> <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>
<span style="color:#960050;background-color:#1e0010">%%</span>createCode:
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">85</span>		<span style="color:#75715e">;; Create
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#960050;background-color:#1e0010">%</span>%fileName	<span style="color:#75715e">;; Filename
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">2</span>		<span style="color:#75715e">;; File Permissions
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">syscall</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>%endmacro

<span style="color:#75715e">;; File open
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">fopen</span> <span style="color:#ae81ff">2</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdi</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdx</span>

	<span style="color:#a6e22e">jmp</span> <span style="color:#960050;background-color:#1e0010">%</span>%openCode
	<span style="color:#960050;background-color:#1e0010">%%</span><span style="color:#a6e22e">fileName</span> <span style="color:#66d9ef">db</span> <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>
<span style="color:#960050;background-color:#1e0010">%%</span>openCode:
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0x02</span>		<span style="color:#75715e">;; Open
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#960050;background-color:#1e0010">%</span>%fileName	<span style="color:#75715e">;; Filename
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">2</span>		<span style="color:#75715e">;; File read flags 00=RD,01=WT,02=RDWT
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#ae81ff">0644</span><span style="color:#66d9ef">o</span>
	<span style="color:#a6e22e">syscall</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Keep rax at top of stack
</span><span style="color:#75715e"></span>%endmacro

<span style="color:#75715e">;; File write
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">fwrite</span> <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdi</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdx</span>

	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>		<span style="color:#75715e">;; File handler to rdi
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">jmp</span> <span style="color:#960050;background-color:#1e0010">%</span>%writeCode
	<span style="color:#960050;background-color:#1e0010">%%</span><span style="color:#a6e22e">bufferS</span> <span style="color:#66d9ef">db</span> <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>
	<span style="color:#960050;background-color:#1e0010">%%</span><span style="color:#a6e22e">bufferLen</span> <span style="color:#66d9ef">equ</span> <span style="color:#66d9ef">$</span> - <span style="color:#960050;background-color:#1e0010">%</span>%bufferS
<span style="color:#960050;background-color:#1e0010">%%</span>writeCode:
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">1</span>		<span style="color:#75715e">;; Write to file
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#960050;background-color:#1e0010">%</span>%bufferS	<span style="color:#75715e">;; Data to write
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#960050;background-color:#1e0010">%</span>%bufferLen	<span style="color:#75715e">;; Data Length
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">syscall</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#66d9ef">rdi</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>%endmacro

<span style="color:#75715e">;; File read
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">fread</span> <span style="color:#ae81ff">2</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdx</span>

	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#66d9ef">rax</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">0</span>		<span style="color:#75715e">;; Read
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>		<span style="color:#75715e">;; Where to store the data
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">2</span>		<span style="color:#75715e">;; Length of read
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">syscall</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>%endmacro


<span style="color:#75715e">;; File close - File handle from stack
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">fclose</span> <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>	<span style="color:#75715e">;; Preserve stack frame
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">push</span> <span style="color:#66d9ef">rdi</span>

	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">3</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">syscall</span>

	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">endmacro</span>
</code></pre></div><p>useful.asm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">PRINT</span> <span style="color:#ae81ff">1</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rax</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">push</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pushf</span>

    	<span style="color:#a6e22e">jmp</span> <span style="color:#960050;background-color:#1e0010">%</span>%astr

	<span style="color:#960050;background-color:#1e0010">%%</span><span style="color:#a6e22e">str</span> <span style="color:#66d9ef">db</span> <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>
	<span style="color:#960050;background-color:#1e0010">%%</span><span style="color:#a6e22e">strln</span> <span style="color:#66d9ef">equ</span> <span style="color:#66d9ef">$-</span><span style="color:#960050;background-color:#1e0010">%</span>%str

<span style="color:#960050;background-color:#1e0010">%%</span>astr: <span style="color:#a6e22e">_syscall_write</span> <span style="color:#960050;background-color:#1e0010">%</span>%str, <span style="color:#960050;background-color:#1e0010">%</span>%strln

	<span style="color:#a6e22e">popf</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdx</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rsi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rdi</span>
	<span style="color:#a6e22e">pop</span> <span style="color:#66d9ef">rax</span>
<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">endmacro</span>

<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">macro</span> <span style="color:#66d9ef">_syscall_write</span> <span style="color:#ae81ff">2</span>
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rax</span>, <span style="color:#ae81ff">1</span>
        <span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdi</span>, <span style="color:#ae81ff">1</span>
        <span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rsi</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">1</span>
        <span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">rdx</span>, <span style="color:#960050;background-color:#1e0010">%</span><span style="color:#ae81ff">2</span>
        <span style="color:#a6e22e">syscall</span>
<span style="color:#960050;background-color:#1e0010">%</span><span style="color:#a6e22e">endmacro</span>
</code></pre></div>
  </div>
  <div class="mt-4 d-flex flex-row justify-content-around">
  <div><i class="text-secondary fas fa-chevron-circle-left" style="font-size: 2em;"></i></div>
  <div><i class="text-secondary fas fa-chevron-circle-right" style="font-size: 2em;"></i></div>
</div>

</article>
<script>
  let showMetadata = function(x) {
    let elem = x.parentNode.nextElementSibling;
    if (window.getComputedStyle(elem)["height"] === "0px") {
      elem.style.maxHeight = elem.scrollHeight + "px";
      x.innerHTML = "&times;";
      x.title = "Hide Metadata";
    } else {
      elem.style.maxHeight = "0px";
      x.innerHTML = "&#43;";
      x.title = "Show Metadata";
    }
  };
</script>


      </main>
    </div>
    <footer>
  <div class="w-50 bg-danger ml-auto mr-auto mt-4" style="height: 2px;"></div>
  <div class="mt-4 mb-2" style="font-size: 0.9em;">
    <p class="text-center">
      &copy; 2018 TerminalCursor |
      A Site Made By Free Open Source Software!
    </p>
  </div>
</footer>

  </body>
</html>
